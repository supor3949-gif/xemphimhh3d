<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="pageTitle">Phim ‚Äì HH3D</title>

  <!-- HLS.js (nh√∫ng m3u8 n·∫øu kh√¥ng b·ªã ch·∫∑n CORS/403) -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    :root{
      --bg:#0f172a;
      --panel:rgba(17,24,39,.55);
      --panel2:rgba(2,6,23,.55);
      --panel3:rgba(11,16,32,.85);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --border:rgba(255,255,255,.12);
      --border2:rgba(255,255,255,.06);
      --green:#22c55e;
      --greenDark:#062a16;
      --blue:#38bdf8;
      --shadow:0 12px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 50% -10%, rgba(56,189,248,.10), transparent 60%),
        radial-gradient(1000px 500px at 20% 0%, rgba(34,197,94,.10), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}

    /* ===== Header ===== */
    .siteHeader{
      position:sticky;top:0;z-index:50;
      background:rgba(2,6,23,.88);
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--border2);
    }
    .headerInner{
      max-width:1200px;margin:0 auto;
      padding:12px 16px;
      display:flex;align-items:center;justify-content:space-between;
      gap:14px;flex-wrap:wrap;
    }
    .brand{display:flex;align-items:center;gap:10px;min-width:220px}
    .logo{width:42px;height:42px;border-radius:12px;box-shadow:0 10px 24px rgba(0,0,0,.35)}
    .brandText{display:flex;flex-direction:column;line-height:1.1}
    .brandName{font-size:18px;font-weight:900;letter-spacing:.3px}
    .brandTag{font-size:12px;color:var(--muted);margin-top:2px}

    .tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end;flex:1}
    .pill{
      background:rgba(11,16,32,.85);
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      font-size:13px;
      color:#cbd5e1;
      white-space:nowrap;
    }

    /* ===== Layout ===== */
    .container{max-width:1200px;margin:0 auto;padding:14px 16px 30px}
    .panel{
      background:var(--panel);
      border:1px solid var(--border2);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panelHeader{
      padding:12px 14px;
      border-bottom:1px solid var(--border2);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      background:rgba(2,6,23,.55);
      flex-wrap:wrap;
    }
    .panelTitle{display:flex;align-items:center;gap:10px;font-weight:900}
    .panelSub{color:var(--muted);font-size:12px;white-space:nowrap}

    .movieRow{
      display:grid;
      grid-template-columns: 240px 1fr;
      gap:14px;
      padding:14px;
      align-items:start;
    }

    .posterBox{
      background:rgba(2,6,23,.45);
      border:1px solid var(--border2);
      border-radius:16px;
      padding:10px;
    }
    .poster{
      width:100%;
      aspect-ratio:2/3;
      border-radius:14px;
      overflow:hidden;
      background:rgba(11,16,32,.85);
      position:relative;
    }
    .poster img{width:100%;height:100%;object-fit:cover;display:block}
    .noimg{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      color:rgba(148,163,184,.95);
      font-weight:900;letter-spacing:.6px;font-size:12px;
    }
    .metaBox{padding:10px 4px 0;}
    .h1{font-size:18px;font-weight:900;margin:0 0 6px}
    .meta{color:var(--muted);font-size:12px;line-height:1.45}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{
      border:none;
      background:rgba(56,189,248,.18);
      border:1px solid rgba(56,189,248,.35);
      color:#dbeafe;
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
    }
    .btn:hover{filter:brightness(1.05)}
    .btn.green{
      background:var(--green);
      color:var(--greenDark);
      border:1px solid rgba(34,197,94,.55);
    }

    /* ===== Switch Vietsub / Thuyet minh ===== */
    .modeRow{display:flex;gap:10px;flex-wrap:wrap;padding:0 14px 12px;}
    .modeBtn{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(2,6,23,.55);
      color:#e5e7eb;
      padding:10px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      transition:.12s ease;
      display:flex;align-items:center;gap:8px;
    }
    .modeBtn:hover{border-color:rgba(56,189,248,.35);transform:translateY(-1px)}
    .modeBtn.active{
      background:rgba(34,197,94,.18);
      border-color:rgba(34,197,94,.55);
      box-shadow:0 10px 18px rgba(34,197,94,.08);
    }
    .modeHint{color:var(--muted);font-size:12px;padding:0 14px 10px}

    /* ===== Player area ===== */
    .playerWrap{padding:0 14px 14px;}
    .playerBox{
      background:rgba(2,6,23,.55);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      overflow:hidden;
    }
    .playerTop{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;flex-wrap:wrap;
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background:rgba(11,16,32,.55);
    }
    .nowPlaying{font-weight:900;font-size:13px}
    .playerBtns{display:flex;gap:8px;flex-wrap:wrap}
    .miniBtn{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(2,6,23,.55);
      color:#e5e7eb;
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      font-size:12px;
    }
    .miniBtn:hover{border-color:rgba(56,189,248,.35)}
    .stage{position:relative;background:#000;aspect-ratio:16/9;width:100%;}
    video, iframe{position:absolute;inset:0;width:100%;height:100%;border:0;background:#000;}
    iframe{display:none;}
    .stageHint{
      padding:10px 12px;
      color:var(--muted);
      font-size:12px;
      background:rgba(2,6,23,.45);
      border-top:1px solid rgba(255,255,255,.08);
    }

    /* ===== Episode tools ===== */
    .epTools{display:flex;gap:10px;flex-wrap:wrap;padding:0 14px 14px;}
    .searchWrap{
      display:flex;align-items:center;gap:8px;
      background:var(--panel3);
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      flex:1;
      min-width:240px;
    }
    .searchWrap input{width:100%;background:none;border:none;outline:none;color:var(--text);font-size:14px;}
    .select{
      background:var(--panel3);
      color:#cbd5e1;
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      outline:none;
      font-size:13px;
    }

    /* ===== Episode grid ===== */
    .epGrid{display:grid;grid-template-columns: repeat(10, 1fr);gap:10px;padding:0 14px 18px;}
    .epBtn{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(2,6,23,.55);
      color:#e5e7eb;
      padding:10px 0;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      transition:.12s ease;
      position:relative;
    }
    .epBtn:hover{transform:translateY(-1px);border-color:rgba(56,189,248,.35)}
    .epBtn.done{border-color: rgba(34,197,94,.55);box-shadow: 0 10px 18px rgba(34,197,94,.08);}
    .epBtn.lock{cursor:not-allowed;opacity:.55}
    .epBtn small{
      position:absolute;bottom:6px;left:0;right:0;
      font-size:10px;color:var(--muted);font-weight:700;
    }

    /* ===== Modal ===== */
    .modalBack{position:fixed;inset:0;background: rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:999;padding:16px;}
    .modal{width:min(520px, 96vw);background: rgba(2,6,23,.95);border:1px solid rgba(255,255,255,.10);border-radius:18px;box-shadow: 0 18px 45px rgba(0,0,0,.55);overflow:hidden;}
    .modalTop{padding:14px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.08);}
    .closeBtn{border:none;background: rgba(255,255,255,.08);color:var(--text);border-radius:10px;padding:8px 10px;cursor:pointer;}
    .modalBody{padding:14px 16px 16px;color:#dbe7ff;font-size:13px;line-height:1.5}
    .muted{color:var(--muted);font-size:12px;margin-top:6px}

    /* ===== Footer note ===== */
    .footerNote{max-width:1200px;margin:0 auto;padding:0 16px 26px;color:var(--muted);font-size:11px;line-height:1.55;}

    @media (max-width: 1100px){ .movieRow{grid-template-columns: 220px 1fr} .epGrid{grid-template-columns: repeat(8, 1fr)} }
    @media (max-width: 860px){ .movieRow{grid-template-columns: 1fr} .epGrid{grid-template-columns: repeat(6, 1fr)} }
    @media (max-width: 560px){ .epGrid{grid-template-columns: repeat(4, 1fr)} }
  </style>
</head>

<body>
  <header class="siteHeader">
    <div class="headerInner">
      <a class="brand" id="homeBrand" href="/" title="V·ªÅ trang ch·ªß">
        <svg class="logo" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#22c55e"/>
              <stop offset="1" stop-color="#38bdf8"/>
            </linearGradient>
          </defs>
          <rect x="6" y="10" width="52" height="44" rx="12" fill="url(#g)" opacity="0.22"/>
          <path d="M18 22h28v20H18z" fill="none" stroke="url(#g)" stroke-width="3"/>
          <path d="M28 27l12 5-12 5z" fill="url(#g)"/>
        </svg>
        <div class="brandText">
          <div class="brandName">XEMPHIMHH3D</div>
          <div class="brandTag">xem phim gi·∫£i tr√≠ ‚Äî nghi√™m c·∫•m v√† kh√¥ng khuy·∫øn kh√≠ch c·ªù b·∫°c online d∆∞·ªõi m·ªçi h√¨nh th·ª©c</div>
        </div>
      </a>

      <div class="tools">
        <div class="pill" id="movieInfo">Phim ‚Ä¢ ...</div>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="panel">
      <div class="panelHeader">
        <div class="panelTitle">üé¨ <span id="movieTitleTop">Phim</span></div>
        <div class="panelSub" id="subInfo">...</div>
      </div>

      <div class="movieRow">
        <div class="posterBox">
          <div class="poster">
            <img id="posterImg" src="" alt="Poster">
            <div class="noimg" id="noimg" style="display:none">NO IMAGE</div>
          </div>
          <div class="metaBox">
            <p class="h1" id="movieTitleLeft">Phim</p>
            <div class="meta">
              <div>Th·ªÉ lo·∫°i: <b id="genreText">...</b></div>
              <div id="metaTotal">T·ªïng t·∫≠p: <b>...</b></div>
              <div id="metaHas">ƒê√£ c√≥ link: <b>...</b></div>
            </div>

            <div class="btnRow">
              <button class="btn" id="btnHome">‚Üê V·ªÅ trang ch·ªß</button>
              <button class="btn green" onclick="scrollToEpisodes()">Xem danh s√°ch t·∫≠p</button>
            </div>
          </div>
        </div>

        <div>
          <div class="modeRow">
            <button class="modeBtn active" id="btnVietsub" type="button">‚úÖ Vietsub</button>
            <button class="modeBtn" id="btnThuyetMinh" type="button">üéôÔ∏è Thuy·∫øt minh</button>
          </div>
          <div class="modeHint" id="modeHint">...</div>

          <div class="playerWrap">
            <div class="playerBox">
              <div class="playerTop">
                <div class="nowPlaying" id="nowPlaying">Ch∆∞a ch·ªçn t·∫≠p</div>
                <div class="playerBtns">
                  <button class="miniBtn" type="button" onclick="openCurrentInNewTab()">M·ªü tab m·ªõi</button>
                  <button class="miniBtn" type="button" onclick="stopPlayer()">D·ª´ng</button>
                </div>
              </div>

              <div class="stage">
                <video id="video" controls playsinline></video>
                <iframe id="frame" allow="autoplay; fullscreen; encrypted-media" referrerpolicy="no-referrer"></iframe>
              </div>

              <div class="stageHint" id="stageHint">
                
              </div>
            </div>
          </div>

          <div class="meta" style="padding:6px 4px 10px">
            ‚úÖ T·∫≠p c√≥ link s·∫Ω c√≥ vi·ªÅn xanh. T·∫≠p ch∆∞a c√≥ link s·∫Ω hi·ªán ‚Äúƒëang c·∫≠p nh·∫≠t‚Äù.
          </div>

          <div class="epTools">
            <div class="searchWrap">
              <span>üîé</span>
              <input id="epSearch" placeholder="Nh·∫≠p s·ªë t·∫≠p‚Ä¶ (vd: 67)" inputmode="numeric" />
            </div>

            <select id="epSort" class="select" title="S·∫Øp x·∫øp">
              <option value="asc">T·∫≠p tƒÉng d·∫ßn</option>
              <option value="desc">T·∫≠p gi·∫£m d·∫ßn</option>
              <option value="done">C√≥ link tr∆∞·ªõc</option>
            </select>
          </div>

          <div class="epGrid" id="epGrid"></div>
        </div>
      </div>
    </section>
  </div>

  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalTop">
        <b id="modalTitle">Th√¥ng b√°o</b>
        <button class="closeBtn" id="closeModal">ƒê√≥ng</button>
      </div>
      <div class="modalBody">
        <div id="modalMsg">...</div>
        <div class="muted" id="modalSub"></div>
      </div>
    </div>
  </div>

  <div class="footerNote">
    <b>L∆∞u √Ω:</b> Ch√∫ng t√¥i t·ª´ ch·ªëi m·ªçi tr√°ch nhi·ªám li√™n quan ƒë·∫øn n·ªôi dung hi·ªÉn th·ªã/t·ªìn t·∫°i tr√™n trang.
    T·∫•t c·∫£ video v√† d·ªØ li·ªáu t·∫°i ƒë√¢y ƒë·ªÅu ƒë∆∞·ª£c t·ªïng h·ª£p t·ª´ c√°c ngu·ªìn ph·ªï bi·∫øn tr√™n Internet, v√† kh√¥ng thu·ªôc quy·ªÅn s·ªü h·ªØu hay ki·ªÉm so√°t c·ªßa ch√∫ng t√¥i.
    Ch√∫ng t√¥i kh√¥ng cung c·∫•p d·ªãch v·ª• ph√°t tr·ª±c tuy·∫øn ch√≠nh th·ª©c. N·∫øu b·∫°n cho r·∫±ng quy·ªÅn l·ª£i c·ªßa m√¨nh b·ªã ·∫£nh h∆∞·ªüng,
    vui l√≤ng li√™n h·ªá ngay cho ch√∫ng t√¥i s·∫Ω x·ª≠ l√Ω v√† g·ª° b·ªè n·ªôi dung vi ph·∫°m k·ªãp th·ªùi. Xin c·∫£m ∆°n s·ª± th√¥ng c·∫£m v√† h·ª£p t√°c c·ªßa b·∫°n.
    V√† xem phim gi·∫£i tr√≠ ‚Äî nghi√™m c·∫•m v√† kh√¥ng khuy·∫øn kh√≠ch c·ªù b·∫°c online d∆∞·ªõi m·ªçi h√¨nh th·ª©c.
  </div>

  <script>
    /* =========================================================
      ‚úÖ TEMPLATE CHU·∫®N TO√ÄN SITE (ch·ªâ s·ª≠a ph·∫ßn CONFIG b√™n d∆∞·ªõi)
      - File phim ƒë·∫∑t trong th∆∞ m·ª•c con v·∫´n OK
      - N√∫t v·ªÅ trang ch·ªß: v·ªÅ "/" (kh√¥ng bao gi·ªù 404)
      - D√°n list t·∫≠p -> t·ª± nh·∫≠n t·ªïng t·∫≠p (l·∫•y s·ªë l·ªõn nh·∫•t)
      - ∆Øu ti√™n nh√∫ng: m3u8/phimapi -> c·ªë nh√∫ng; fail -> m·ªü tab m·ªõi
      - AFF: random TikTok/Shopee (mobile -> app/web, PC -> web)
    ========================================================= */

    /* =========================
       ‚úÖ CONFIG (CH·ªà S·ª¨A KHU V·ª∞C N√ÄY)
    ========================= */

    // 1) V·ªÅ trang ch·ªß (CHU·∫®N VERCEL): ƒë·ªÉ "/" ho·∫∑c "/index.html"
    const HOME_LINK = "/";

    // 2) Th√¥ng tin phim
    const MOVIE_TITLE = "T·ª≠ Xuy√™n (Ph·∫ßn 2)";
    const GENRE_TEXT  = "Khoa H·ªçc, Vi·ªÖn T∆∞·ªüng, Ch√≠nh K·ªãch, T√¢m L√Ω";

    // 3) Poster
    // - N·∫øu ·∫£nh n·∫±m trong c√πng th∆∞ m·ª•c con: "images/anh.jpg"
    // - N·∫øu ·∫£nh n·∫±m ngo√†i: "../images/anh.jpg"
    // - Ho·∫∑c link https
    const POSTER_URL  = "../images/txp2.jpg";

    // 4) D√°n list t·∫≠p (m·ªói d√≤ng: "T·∫≠p 01|https://..." ho·∫∑c "1|https://...")
    const RAW_VIETSUB = `
T·∫≠p 01|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/kQdtZ7dk/index.m3u8
T·∫≠p 02|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/yrp1BxKM/index.m3u8
T·∫≠p 03|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/XxehreTC/index.m3u8
T·∫≠p 04|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/woncHUK9/index.m3u8
T·∫≠p 05|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/bZlxGPSx/index.m3u8
T·∫≠p 06|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250822/2jT9ZbXy/index.m3u8
T·∫≠p 07|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250829/SFAWHgSJ/index.m3u8
T·∫≠p 08|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250903/RWXL9XIk/index.m3u8
T·∫≠p 09|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250910/ePCooMMJ/index.m3u8
T·∫≠p 10|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250916/tUVPJzVQ/index.m3u8
T·∫≠p 11|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250924/MNllqd9F/index.m3u8
T·∫≠p 12|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251002/oi1wfQXX/index.m3u8
T·∫≠p 13|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251008/me7XSMva/index.m3u8
T·∫≠p 14|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251015/rnowcDzl/index.m3u8
T·∫≠p 15|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251024/r1gh2Sfc/index.m3u8
T·∫≠p 16|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251029/d7mER3Xx/index.m3u8
T·∫≠p 17|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251105/vUP0OozI/index.m3u8
T·∫≠p 18|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251112/83J5cF21/index.m3u8
T·∫≠p 19|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251120/04F27H0h/index.m3u8
T·∫≠p 20|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251214/elShMqq2/index.m3u8
T·∫≠p 21|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251214/lbUeU5g0/index.m3u8
T·∫≠p 22|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251214/WTVDaiMv/index.m3u8
T·∫≠p 23|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251214/SDpbMOWp/index.m3u8
T·∫≠p 24|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251214/Il2bt0Dh/index.m3u8
T·∫≠p 25|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20251214/H0LUn07h/index.m3u8
T·∫≠p 26|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260107/7fRYQjik/index.m3u8
T·∫≠p 27|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260107/bVXPKvEr/index.m3u8
T·∫≠p 28|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260114/naTJd63q/index.m3u8
T·∫≠p 29|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260121/SpAQt1Zg/index.m3u8
T·∫≠p 30|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20260128/IaYhMqNK/index.m3u8

`.trim();

    const RAW_THUYETMINH = `
    T·∫≠p 01|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/6hyrnr6W/index.m3u8
T·∫≠p 02|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/d7Q1Q228/index.m3u8
T·∫≠p 03|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/KkS1ilXB/index.m3u8
T·∫≠p 04|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/bF5jFVxk/index.m3u8
T·∫≠p 05|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250813/dEsM2ATK/index.m3u8
T·∫≠p 06|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250822/J147ICNp/index.m3u8
T·∫≠p 07|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250829/Rbqm4wcq/index.m3u8
TaÃ£ÃÇp 8|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250918/cAX9Z65G/index.m3u8
T·∫≠p 09|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250910/ePCooMMJ/index.m3u8
T·∫≠p 10|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250916/RtL3dzY4/index.m3u8
T·∫≠p 11|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250924/G8V7W1wT/index.m3u8

`.trim();

    // 5) AFF (random 2 ngu·ªìn)
    const AFF_JUMP_RATE = 0.90; // 0.30 = 30% nh·∫£y, 70% kh√¥ng nh·∫£y

    // TikTok (universal link)
    const TIKTOK_WEB = "https://vt.tiktok.com/ZS91xpNUw7kcD-nRXjG/";
    // Shopee (d√°n aff c·ªßa em)
    const SHOPEE_WEB = "https://s.shopee.vn/3fxvwKdzAg";
    // n·∫øu c√≥ deep link app shopee th√¨ d√°n, kh√¥ng c√≥ th√¨ ƒë·ªÉ r·ªóng
    const SHOPEE_APP = "https://s.shopee.vn/3fxvwKdzAg";

    /* =========================
       ‚úÖ END CONFIG
    ========================= */

    /* =========================================================
      ‚úÖ AFF helpers (an to√†n popup)
    ========================================================= */
    function isMobileDevice(){ return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent); }

    function openNewTabSafe(url){
      if (!url) return;
      if (isMobileDevice()){
        location.href = url;
        return;
      }
      const w = window.open("about:blank", "_blank");
      if (w) w.location.href = url;
      else location.href = url;
    }

    function openMobileWithFallback(appUrl, webUrl){
      const hasWeb = !!(webUrl && webUrl.trim());
      const hasApp = !!(appUrl && appUrl.trim());
      if (!hasApp){
        if (hasWeb) location.href = webUrl;
        return;
      }
      location.href = appUrl;
      setTimeout(() => { if (hasWeb) location.href = webUrl; }, 900);
    }

    function openAFFRandom(){
      const sources = [
        { name:"tiktok", mobileApp:"", mobileWeb:TIKTOK_WEB, pcWeb:TIKTOK_WEB },
        { name:"shopee", mobileApp:SHOPEE_APP, mobileWeb:SHOPEE_WEB, pcWeb:SHOPEE_WEB },
      ].filter(x => (x.mobileWeb && x.mobileWeb.trim()) || (x.pcWeb && x.pcWeb.trim()) || (x.mobileApp && x.mobileApp.trim()));

      if (!sources.length) return;
      const pick = sources[Math.floor(Math.random()*sources.length)];

      if (isMobileDevice()){
        openMobileWithFallback(pick.mobileApp, pick.mobileWeb || pick.pcWeb);
      } else {
        openNewTabSafe(pick.pcWeb || pick.mobileWeb);
      }
    }

    function maybeJumpAFF(){
      if (Math.random() < AFF_JUMP_RATE){
        // g·ªçi NGAY trong click ƒë·ªÉ tr√°nh b·ªã ch·∫∑n popup
        openAFFRandom();
      }
    }

    /* =========================================================
      ‚úÖ Parse list
    ========================================================= */
    function parseList(raw){
      const map = {};
      if (!raw) return map;
      const lines = raw.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      for (const line of lines){
        const parts = line.split("|");
        if (parts.length < 2) continue;
        const left = parts[0].trim();
        const url = parts.slice(1).join("|").trim();
        const m = left.match(/(\d+)/);
        if (!m) continue;
        const ep = parseInt(m[1], 10);
        if (!Number.isFinite(ep)) continue;
        map[ep] = url || "";
      }
      return map;
    }

    const EP_URLS_VIETSUB = parseList(RAW_VIETSUB);
    const EP_URLS_THUYETMINH = parseList(RAW_THUYETMINH);

    function getMaxEp(map){
      const keys = Object.keys(map || {}).map(n => parseInt(n,10)).filter(n => Number.isFinite(n));
      return keys.length ? Math.max(...keys) : 0;
    }
    function countHasLink(map){
      return Object.values(map || {}).filter(u => !!(u && u.trim())).length;
    }

    let MODE = "vietsub";
    function getUrlsByMode(){ return MODE === "vietsub" ? EP_URLS_VIETSUB : EP_URLS_THUYETMINH; }
    function getTotalByMode(){
      const t = getMaxEp(getUrlsByMode());
      return t; // auto nh·∫≠n t·ªïng t·∫≠p
    }

    /* =========================================================
      ‚úÖ Player (∆∞u ti√™n nh√∫ng -> fail th√¨ m·ªü tab m·ªõi)
    ========================================================= */
    const videoEl = document.getElementById("video");
    const frameEl = document.getElementById("frame");
    let hlsInstance = null;
    let CURRENT_URL = "";
    let FALLBACK_TIMER = null;

    function isPhimApiPlayer(u){ return /^https?:\/\/player\.phimapi\.com\/player\/\?/i.test(u || ""); }
    function extractInnerUrlFromPhimApi(u){
      try{ const x = new URL(u); return x.searchParams.get("url") || ""; }catch(e){ return ""; }
    }
    function isM3U8(u){ return /\.m3u8(\?|$)/i.test(u || ""); }

    function clearFallbackTimer(){
      if (FALLBACK_TIMER) clearTimeout(FALLBACK_TIMER);
      FALLBACK_TIMER = null;
    }

    function stopHlsOnly(){
      clearFallbackTimer();
      try{ if (hlsInstance) hlsInstance.destroy(); }catch(e){}
      hlsInstance = null;
      try{ videoEl.pause(); videoEl.removeAttribute("src"); videoEl.load(); }catch(e){}
    }

    function stopPlayer(){
      CURRENT_URL = "";
      document.getElementById("nowPlaying").textContent = "Ch∆∞a ch·ªçn t·∫≠p";
      stopHlsOnly();
      frameEl.style.display = "none";
      frameEl.src = "about:blank";
      videoEl.style.display = "block";
    }

    function openCurrentInNewTab(){
      if (CURRENT_URL) openNewTabSafe(CURRENT_URL);
      else showModal("Ch∆∞a c√≥ link", "B·∫°n ch∆∞a ch·ªçn t·∫≠p.", "");
    }

    function showVideo(){ frameEl.style.display="none"; videoEl.style.display="block"; }
    function showFrame(){ videoEl.style.display="none"; frameEl.style.display="block"; }

    function forceFallbackOpen(url){
      if (!url) return;
      stopHlsOnly();
      openNewTabSafe(url);
    }

    function playM3U8(url, fallbackUrl){
      stopHlsOnly();
      showVideo();

      // n·∫øu sau 2.2s v·∫´n kh√¥ng play ƒë∆∞·ª£c => m·ªü tab m·ªõi
      clearFallbackTimer();
      FALLBACK_TIMER = setTimeout(() => {
        const notReady = (videoEl.readyState < 2);
        const paused = videoEl.paused;
        if (notReady || paused) forceFallbackOpen(fallbackUrl || url);
      }, 2200);

      const canNative = videoEl.canPlayType("application/vnd.apple.mpegurl");

      try{
        if (canNative){
          videoEl.src = url;
          videoEl.play().catch(() => forceFallbackOpen(fallbackUrl || url));
          return true;
        }

        if (window.Hls && window.Hls.isSupported()){
          hlsInstance = new Hls({ xhrSetup: xhr => { xhr.withCredentials = false; } });
          hlsInstance.loadSource(url);
          hlsInstance.attachMedia(videoEl);

          hlsInstance.on(Hls.Events.MANIFEST_PARSED, () => {
            videoEl.play().catch(() => forceFallbackOpen(fallbackUrl || url));
          });

          hlsInstance.on(Hls.Events.ERROR, (event, data) => {
            if (data && data.fatal){
              forceFallbackOpen(fallbackUrl || url);
            }
          });
          return true;
        }

        forceFallbackOpen(fallbackUrl || url);
        return false;
      }catch(e){
        forceFallbackOpen(fallbackUrl || url);
        return false;
      }
    }

    function playURL(url, epLabel){
      if (!url || !url.trim()){
        showModal("ƒêang c·∫≠p nh·∫≠t", "T·∫≠p n√†y ch∆∞a c√≥ link.", "B·∫°n quay l·∫°i sau nha.");
        return;
      }

      CURRENT_URL = url;
      document.getElementById("nowPlaying").textContent =
        epLabel ? `${MOVIE_TITLE} ‚Ä¢ ${epLabel} ‚Ä¢ ${MODE === "vietsub" ? "VIETSUB" : "THUY·∫æT MINH"}` : `${MOVIE_TITLE}`;

      // ‚úÖ ∆∞u ti√™n nh√∫ng m3u8 (k·ªÉ c·∫£ phimapi)
      if (isPhimApiPlayer(url)){
        const inner = extractInnerUrlFromPhimApi(url);
        if (inner && isM3U8(inner)){
          playM3U8(inner, url);
          maybeJumpAFF();
          return;
        }
        // kh√¥ng b√≥c ƒë∆∞·ª£c -> m·ªü tab
        openNewTabSafe(url);
        maybeJumpAFF();
        return;
      }

      if (isM3U8(url)){
        playM3U8(url, url);
        maybeJumpAFF();
        return;
      }

      // link kh√°c: th·ª≠ iframe, ƒë·ªìng th·ªùi ch·∫Øc ch·∫Øn m·ªü tab m·ªõi ƒë·ªÉ kh√¥ng b·ªã ‚Äútr·∫Øng‚Äù
      showFrame();
      frameEl.src = url;

      // ƒë·∫£m b·∫£o m·ªü tab m·ªõi (ƒë√∫ng checklist)
      setTimeout(() => openNewTabSafe(url), 350);
      maybeJumpAFF();
    }

    /* =========================================================
      ‚úÖ UI
    ========================================================= */
    function scrollToEpisodes(){
      document.getElementById("epGrid").scrollIntoView({behavior:"smooth", block:"start"});
    }
    function pad2(n){ return String(n).padStart(2,"0"); }

    function getEpList(){
      const total = getTotalByMode();
      const urls = getUrlsByMode();
      if (!total) return [];
      const arr = Array.from({length: total}, (_,i)=>i+1);

      const q = (document.getElementById("epSearch").value || "").trim();
      let out = arr;
      if (q){
        const n = parseInt(q, 10);
        if (!Number.isNaN(n)) out = arr.filter(x => x === n);
      }

      const mode = document.getElementById("epSort").value;
      if (mode === "desc") out = out.slice().sort((a,b)=>b-a);
      else if (mode === "done"){
        out = out.slice().sort((a,b)=>{
          const da = !!(urls[a] && urls[a].trim());
          const db = !!(urls[b] && urls[b].trim());
          if (da === db) return a-b;
          return (db?1:0) - (da?1:0);
        });
      }
      return out;
    }

    function renderHeaderMeta(){
      const total = getTotalByMode();
      const has = countHasLink(getUrlsByMode());
      const modeText = MODE === "vietsub" ? "Vietsub" : "Thuy·∫øt minh";

      document.getElementById("movieInfo").textContent = `${MOVIE_TITLE} ‚Ä¢ ${modeText} ‚Ä¢ ${total} t·∫≠p`;
      document.getElementById("subInfo").textContent = `Ch·∫ø ƒë·ªô: ${modeText} ‚Ä¢ C√≥ link: ${has}/${total}`;
      document.getElementById("metaTotal").innerHTML = `T·ªïng t·∫≠p (${modeText}): <b>${total || 0}</b>`;
      document.getElementById("metaHas").innerHTML = `ƒê√£ c√≥ link: <b>${has}</b>`;
      document.getElementById("modeHint").innerHTML =
        `B·∫°n ƒëang xem: <b>${modeText}</b> ‚Ä¢ B·∫•m t·∫≠p ƒë·ªÉ ph√°t .`;
    }

    function renderEpisodes(){
      renderHeaderMeta();
      const grid = document.getElementById("epGrid");
      grid.innerHTML = "";

      const total = getTotalByMode();
      const urls = getUrlsByMode();
      const eps = getEpList();

      if (!total){
        grid.innerHTML = `<div class="meta" style="grid-column:1/-1;padding:10px 4px">
          
        </div>`;
        return;
      }

      eps.forEach(ep=>{
        const btn = document.createElement("button");
        btn.className = "epBtn";
        btn.type = "button";
        btn.textContent = pad2(ep);

        const url = (urls[ep] || "").trim();
        const hasLink = !!url;
        if (hasLink) btn.classList.add("done");
        else btn.classList.add("lock");

        const note = document.createElement("small");
        note.textContent = hasLink ? "C√≥ link" : "ƒêang c·∫≠p nh·∫≠t";
        btn.appendChild(note);

        btn.onclick = () => {
          if (!url){
            showModal(`${MOVIE_TITLE} ‚Äì T·∫≠p ${pad2(ep)} (${MODE === "vietsub" ? "Vietsub" : "Thuy·∫øt minh"})`,
                      "T·∫≠p n√†y ch∆∞a c√≥ link.", "B·∫°n quay l·∫°i sau nha.");
            return;
          }
          playURL(url, `T·∫≠p ${pad2(ep)}`);
        };

        grid.appendChild(btn);
      });
    }

    function showModal(title, msg, sub){
      document.getElementById("modalTitle").textContent = title;
      document.getElementById("modalMsg").textContent = msg;
      document.getElementById("modalSub").textContent = sub || "";
      document.getElementById("modalBack").style.display = "flex";
    }
    function hideModal(){ document.getElementById("modalBack").style.display = "none"; }

    function setMode(m){
      MODE = m;
      document.getElementById("btnVietsub").classList.toggle("active", MODE === "vietsub");
      document.getElementById("btnThuyetMinh").classList.toggle("active", MODE === "thuyetminh");
      document.getElementById("epSearch").value = "";
      document.getElementById("epSort").value = "asc";
      stopPlayer();
      renderEpisodes();
    }

    /* =========================================================
      ‚úÖ INIT (logo, ph√°p l√Ω, home, poster)
    ========================================================= */
    document.getElementById("btnHome").onclick = () => location.href = HOME_LINK;
    document.getElementById("homeBrand").href = HOME_LINK;

    document.getElementById("pageTitle").textContent = `${MOVIE_TITLE} ‚Äì HH3D`;
    document.getElementById("movieTitleTop").textContent = MOVIE_TITLE;
    document.getElementById("movieTitleLeft").textContent = MOVIE_TITLE;
    document.getElementById("genreText").textContent = GENRE_TEXT;

    (function initPoster(){
      const img = document.getElementById("posterImg");
      const no = document.getElementById("noimg");
      img.alt = MOVIE_TITLE || "Poster";

      if (!POSTER_URL || !POSTER_URL.trim()){
        img.style.display = "none";
        no.style.display = "flex";
        return;
      }
      img.onload = () => { img.style.display = "block"; no.style.display = "none"; };
      img.onerror = () => { img.style.display = "none"; no.style.display = "flex"; };
      img.src = POSTER_URL;
    })();

    document.getElementById("epSearch").addEventListener("input", renderEpisodes);
    document.getElementById("epSort").addEventListener("change", renderEpisodes);
    document.getElementById("btnVietsub").addEventListener("click", () => setMode("vietsub"));
    document.getElementById("btnThuyetMinh").addEventListener("click", () => setMode("thuyetminh"));
    document.getElementById("closeModal").addEventListener("click", hideModal);
    document.getElementById("modalBack").addEventListener("click", (e)=>{ if(e.target.id==="modalBack") hideModal(); });
    document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") hideModal(); });

    setMode("vietsub");
  </script>
</body>
</html>
