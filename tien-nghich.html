<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ti√™n Ngh·ªãch ‚Äì XEMPHIMHH3D</title>

  <!-- HLS.js (ph√°t m3u8 tr√™n Chrome/Edge/Firefox) -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    :root{
      --bg:#0f172a;
      --panel:rgba(17,24,39,.55);
      --panel2:rgba(2,6,23,.55);
      --panel3:rgba(11,16,32,.85);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --border:rgba(255,255,255,.12);
      --border2:rgba(255,255,255,.06);
      --green:#22c55e;
      --greenDark:#062a16;
      --blue:#38bdf8;
      --shadow:0 12px 28px rgba(0,0,0,.35);
      --red:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 50% -10%, rgba(56,189,248,.10), transparent 60%),
        radial-gradient(1000px 500px at 20% 0%, rgba(34,197,94,.10), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}

    .siteHeader{
      position:sticky;top:0;z-index:50;
      background:rgba(2,6,23,.88);
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--border2);
    }
    .headerInner{
      max-width:1200px;margin:0 auto;
      padding:12px 16px;
      display:flex;align-items:center;justify-content:space-between;
      gap:14px;flex-wrap:wrap;
    }
    .brand{display:flex;align-items:center;gap:10px;min-width:220px}
    .logo{width:42px;height:42px;border-radius:12px;box-shadow:0 10px 24px rgba(0,0,0,.35)}
    .brandText{display:flex;flex-direction:column;line-height:1.1}
    .brandName{font-size:18px;font-weight:900;letter-spacing:.3px}
    .brandTag{font-size:12px;color:var(--muted);margin-top:2px}

    .tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end;flex:1}
    .pill{
      background:rgba(11,16,32,.85);
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      font-size:13px;
      color:#cbd5e1;
    }

    .container{max-width:1200px;margin:0 auto;padding:14px 16px 24px}
    .panel{
      background:var(--panel);
      border:1px solid var(--border2);
      border-radius:16px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .panelHeader{
      padding:12px 14px;
      border-bottom:1px solid var(--border2);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      background:rgba(2,6,23,.55);
    }
    .panelTitle{display:flex;align-items:center;gap:10px;font-weight:900}
    .panelSub{color:var(--muted);font-size:12px;white-space:nowrap}

    .movieRow{
      display:grid;
      grid-template-columns: 240px 1fr;
      gap:14px;
      padding:14px;
      align-items:start;
    }

    .posterBox{
      background:rgba(2,6,23,.45);
      border:1px solid var(--border2);
      border-radius:16px;
      padding:10px;
    }
    .poster{
      width:100%;
      aspect-ratio:2/3;
      border-radius:14px;
      overflow:hidden;
      background:rgba(11,16,32,.85);
      position:relative;
    }
    .poster img{width:100%;height:100%;object-fit:cover;display:block}
    .noimg{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      color:rgba(148,163,184,.95);
      font-weight:900;letter-spacing:.6px;font-size:12px;
    }

    .metaBox{padding:10px 4px 0}
    .h1{font-size:18px;font-weight:900;margin:0 0 6px}
    .meta{color:var(--muted);font-size:12px;line-height:1.5}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{
      border:none;
      background:rgba(56,189,248,.18);
      border:1px solid rgba(56,189,248,.35);
      color:#dbeafe;
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
    }
    .btn:hover{filter:brightness(1.05)}
    .btn.green{
      background:var(--green);
      color:var(--greenDark);
      border:1px solid rgba(34,197,94,.55);
    }

    /* Player box */
    .playerWrap{
      background:rgba(2,6,23,.45);
      border:1px solid var(--border2);
      border-radius:16px;
      padding:12px;
      overflow:hidden;
    }
    .playerTop{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:10px;
    }
    .playerTitle{
      font-weight:900;
      font-size:14px;
      color:#e8eefb;
    }
    .playerHint{color:var(--muted);font-size:12px}
    .playerBox{
      width:100%;
      border-radius:14px;
      overflow:hidden;
      background:#0b1020;
      border:1px solid rgba(255,255,255,.08);
      aspect-ratio: 16/9;
      position:relative;
    }
    video{
      width:100%;height:100%;
      display:block;
      background:#000;
    }
    iframe{
      width:100%;height:100%;
      border:0;
      display:block;
      background:#000;
    }
    .playerMsg{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      color:#cbd5e1;
      padding:12px;
      text-align:center;
      font-weight:800;
      line-height:1.4;
    }
    .playerState{
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .statePill{
      border:1px solid rgba(255,255,255,.08);
      background:rgba(2,6,23,.45);
      border-radius:999px;
      padding:6px 10px;
    }

    /* Sub/Thuyet minh toggle */
    .modeRow{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .modeBtn{
      flex:0 0 auto;
      min-width:140px;
      border-radius:14px;
      padding:10px 12px;
      font-weight:900;
      cursor:pointer;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(2,6,23,.55);
      color:#e5e7eb;
      transition:.12s ease;
    }
    .modeBtn:hover{border-color:rgba(56,189,248,.35);transform:translateY(-1px)}
    .modeBtn.active{
      background:rgba(34,197,94,.16);
      border-color:rgba(34,197,94,.55);
      color:#dcfce7;
      box-shadow: 0 10px 18px rgba(34,197,94,.08);
    }

    .epTools{
      display:flex;gap:10px;flex-wrap:wrap;
      margin-top:10px;
    }
    .searchWrap{
      display:flex;align-items:center;gap:8px;
      background:var(--panel3);
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      flex:1;
      min-width:240px;
    }
    .searchWrap input{
      width:100%;
      background:none;border:none;outline:none;
      color:var(--text);
      font-size:14px;
    }
    .select{
      background:var(--panel3);
      color:#cbd5e1;
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      outline:none;
      font-size:13px;
      cursor:pointer;
    }

    .epGrid{
      display:grid;
      grid-template-columns: repeat(10, 1fr);
      gap:10px;
      margin-top:12px;
    }
    .epBtn{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(2,6,23,.55);
      color:#e5e7eb;
      padding:10px 0;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      transition:.12s ease;
      position:relative;
      user-select:none;
    }
    .epBtn:hover{transform:translateY(-1px);border-color:rgba(56,189,248,.35)}
    .epBtn.done{
      border-color: rgba(34,197,94,.55);
      box-shadow: 0 10px 18px rgba(34,197,94,.08);
    }
    .epBtn.lock{
      cursor:not-allowed;
      opacity:.55;
    }
    .epBtn small{
      position:absolute;
      bottom:6px;left:0;right:0;
      font-size:10px;
      color:var(--muted);
      font-weight:700;
    }

    .noteLine{
      margin-top:10px;
      color:#cbd5e1;
      font-size:12px;
      line-height:1.5;
    }
    .noteLine .ok{color:#86efac;font-weight:900}
    .noteLine .warn{color:#fca5a5;font-weight:900}

    /* Modal */
    .modalBack{
      position:fixed;inset:0;
      background: rgba(0,0,0,.55);
      display:none;align-items:center;justify-content:center;
      z-index:999;padding:16px;
    }
    .modal{
      width:min(520px, 96vw);
      background: rgba(2,6,23,.95);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      box-shadow: 0 18px 45px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalTop{
      padding:14px 16px;
      display:flex;align-items:center;justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .closeBtn{
      border:none;
      background: rgba(255,255,255,.08);
      color:var(--text);
      border-radius:10px;
      padding:8px 10px;
      cursor:pointer;
    }
    .modalBody{padding:14px 16px 16px;color:#dbe7ff;font-size:13px;line-height:1.5}
    .muted{color:var(--muted);font-size:12px;margin-top:6px}

    /* Footer note */
    .footerNote{
      max-width:1200px;
      margin:14px auto 26px;
      padding:0 16px;
      color:#a7b0c0;
      font-size:11px;
      line-height:1.55;
      opacity:.92;
    }
    .footerNote b{color:#dbeafe}

    @media (max-width: 1100px){
      .movieRow{grid-template-columns: 220px 1fr}
      .epGrid{grid-template-columns: repeat(8, 1fr)}
    }
    @media (max-width: 860px){
      .movieRow{grid-template-columns: 1fr}
      .epGrid{grid-template-columns: repeat(6, 1fr)}
    }
    @media (max-width: 560px){
      .epGrid{grid-template-columns: repeat(4, 1fr)}
    }
  </style>
</head>

<body>
  <header class="siteHeader">
    <div class="headerInner">
      <a class="brand" href="index.html" title="V·ªÅ trang ch·ªß">
        <svg class="logo" viewBox="0 0 64 64" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0" stop-color="#22c55e"/>
              <stop offset="1" stop-color="#38bdf8"/>
            </linearGradient>
          </defs>
          <rect x="6" y="10" width="52" height="44" rx="12" fill="url(#g)" opacity="0.22"/>
          <path d="M18 22h28v20H18z" fill="none" stroke="url(#g)" stroke-width="3"/>
          <path d="M28 27l12 5-12 5z" fill="url(#g)"/>
        </svg>
        <div class="brandText">
          <div class="brandName">XEMPHIMHH3D</div>
          <div class="brandTag">xem phim gi·∫£i tr√≠ ‚Ä¢ nghi√™m c·∫•m v√† kh√¥ng khuy·∫øn kh√≠ch c·ªù b·∫°c online d∆∞·ªõi m·ªçi h√¨nh th·ª©c</div>
        </div>
      </a>

      <div class="tools">
        <div class="pill" id="movieInfo">Ti√™n Ngh·ªãch ‚Ä¢ 128 t·∫≠p</div>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="panel">
      <div class="panelHeader">
        <div class="panelTitle">üé¨ <span id="movieTitleTop">Ti√™n Ngh·ªãch</span></div>
        <div class="panelSub" id="subInfo"></div>
      </div>

      <div class="movieRow">
        <!-- LEFT -->
        <div class="posterBox">
          <div class="poster">
            <!-- ‚úÖ POSTER: ƒë·ªïi ·∫£nh t·∫°i ƒë√¢y -->
            <img src="images/anh-tien-nghich.jpg" alt="Ti√™n Ngh·ªãch"
                 onerror="this.remove(); document.getElementById('noimg').style.display='flex';">
            <div class="noimg" id="noimg" style="display:none">NO IMAGE</div>
          </div>

          <div class="metaBox">
            <p class="h1" id="movieTitleLeft">Ti√™n Ngh·ªãch</p>
            <div class="meta">
              <div>Th·ªÉ lo·∫°i: <b>Ti√™n hi·ªáp</b></div>
              <div>T·ªïng t·∫≠p (hi·ªÉn th·ªã): <b id="totalEpShow">128</b></div>
              <div>Vietsub: <b id="vsCount">125</b> ‚Ä¢ Thuy·∫øt minh: <b id="tmCount">107</b></div>
            </div>

            <div class="btnRow">
              <button class="btn" onclick="location.href='index.html'">‚Üê V·ªÅ trang ch·ªß</button>
              <button class="btn green" onclick="scrollToEpisodes()">Xem danh s√°ch t·∫≠p</button>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div>
          <div class="playerWrap">
            <div class="playerTop">
              <div class="playerTitle" id="nowPlayingTitle">Ti√™n Ngh·ªãch ‚Äì T·∫≠p 01</div>
              <div class="playerHint" id="playerTypeLabel">Ch∆∞a ch·ªçn t·∫≠p</div>
            </div>

            <div class="playerBox" id="playerBox">
              <div class="playerMsg" id="playerMsg">
                Ch·ªçn t·∫≠p ƒë·ªÉ xem. (H·ªó tr·ª£: m3u8 / player.phimapi / link embed kh√°c)
              </div>
              <!-- video/iframe s·∫Ω ƒë∆∞·ª£c JS g·∫Øn v√†o ƒë√¢y -->
            </div>

            <div class="playerState">
              <div class="statePill" id="modeLabel">ƒêang ch·ªçn: Vietsub</div>
              <div class="statePill" id="affLabel"></div>
            </div>

            <div class="noteLine">
              <span class="ok">‚úÖ</span> T·∫≠p n√†o c√≥ link s·∫Ω c√≥ vi·ªÅn xanh.
              <span class="warn">‚ö†</span> 
            </div>

            <!-- ‚úÖ 2 √¥ ch·ªçn: THUY·∫æT MINH / VIETSUB -->
            <div class="modeRow" id="modeRow">
              <button class="modeBtn" id="btnTM" type="button">THUY·∫æT MINH</button>
              <button class="modeBtn active" id="btnVS" type="button">VIETSUB</button>
            </div>

            <!-- tools -->
            <div class="epTools" id="episodeTools">
              <div class="searchWrap">
                <span>üîé</span>
                <input id="epSearch" placeholder="Nh·∫≠p s·ªë t·∫≠p‚Ä¶ (vd: 67)" inputmode="numeric" />
              </div>

              <select id="epSort" class="select" title="S·∫Øp x·∫øp">
                <option value="asc">T·∫≠p tƒÉng d·∫ßn</option>
                <option value="desc">T·∫≠p gi·∫£m d·∫ßn</option>
                <option value="done">C√≥ link tr∆∞·ªõc</option>
              </select>
            </div>

            <!-- grid -->
            <div class="epGrid" id="epGrid"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Modal -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modalTop">
        <b id="modalTitle">ƒêang c·∫≠p nh·∫≠t</b>
        <button class="closeBtn" id="closeModal">ƒê√≥ng</button>
      </div>
      <div class="modalBody">
        <div id="modalMsg">T·∫≠p n√†y ch∆∞a c√≥ link.</div>
        <div class="muted" id="modalSub">B·∫°n quay l·∫°i sau nha.</div>
      </div>
    </div>
  </div>

  <div class="footerNote">
    <b>L∆∞u √Ω:</b> Ch√∫ng t√¥i t·ª´ ch·ªëi m·ªçi tr√°ch nhi·ªám li√™n quan ƒë·∫øn n·ªôi dung hi·ªÉn th·ªã/t·ªìn t·∫°i tr√™n trang.
    T·∫•t c·∫£ video v√† d·ªØ li·ªáu t·∫°i ƒë√¢y ƒë·ªÅu ƒë∆∞·ª£c t·ªïng h·ª£p t·ª´ c√°c ngu·ªìn ph·ªï bi·∫øn tr√™n Internet, v√† kh√¥ng thu·ªôc quy·ªÅn s·ªü h·ªØu hay ki·ªÉm so√°t c·ªßa ch√∫ng t√¥i.
    Ch√∫ng t√¥i kh√¥ng cung c·∫•p d·ªãch v·ª• ph√°t tr·ª±c tuy·∫øn ch√≠nh th·ª©c. N·∫øu b·∫°n cho r·∫±ng quy·ªÅn l·ª£i c·ªßa m√¨nh b·ªã ·∫£nh h∆∞·ªüng,
    vui l√≤ng li√™n h·ªá ngay cho ch√∫ng t√¥i s·∫Ω x·ª≠ l√Ω v√† g·ª° b·ªè n·ªôi dung vi ph·∫°m k·ªãp th·ªùi. Xin c·∫£m ∆°n s·ª± th√¥ng c·∫£m v√† h·ª£p t√°c c·ªßa b·∫°n.
    V√† xem phim gi·∫£i tr√≠ ‚Ä¢ nghi√™m c·∫•m v√† kh√¥ng khuy·∫øn kh√≠ch c·ªù b·∫°c online d∆∞·ªõi m·ªçi h√¨nh th·ª©c.
  </div>

  <script>
    /* =========================================================
      C·∫§U H√åNH PHIM
    ========================================================= */
    const MOVIE_TITLE = "Ti√™n Ngh·ªãch";
    const GENRE_TEXT  = "Ti√™n hi·ªáp";
    const TOTAL_EP_DISPLAY = 128;

    // ‚úÖ S·ªê T·∫¨P THEO LO·∫†I (ƒë√∫ng nh∆∞ em ch·ªët)
    const COUNT_VIETSUB = 125;
    const COUNT_THUYETMINH = 107;

    // ‚úÖ 2 LIST LINK: em d√°n v√†o ƒë√¢y theo ƒë·ªãnh d·∫°ng:
    // T·∫≠p 01|https://....
    // T·∫≠p 02|https://....
    // ...
    // (NH·ªö: ph·∫£i n·∫±m trong d·∫•u ` ` ƒë·ªÉ nhi·ªÅu d√≤ng)

    const RAW_VIETSUB = `
      T·∫≠p 01|https://s4.phim1280.tv/20240902/nkndLrz4/index.m3u8
T·∫≠p 02|https://s4.phim1280.tv/20240902/81WUV6fg/index.m3u8
T·∫≠p 03|https://s4.phim1280.tv/20240902/vnt5dWem/index.m3u8
T·∫≠p 04|https://s4.phim1280.tv/20240902/P9JDqwRd/index.m3u8
T·∫≠p 05|https://s4.phim1280.tv/20240902/qxtZu37s/index.m3u8
T·∫≠p 06|https://s4.phim1280.tv/20240902/9GBHeFgZ/index.m3u8
T·∫≠p 07|https://s4.phim1280.tv/20240902/e1ZUCMpW/index.m3u8
T·∫≠p 08|https://s4.phim1280.tv/20240902/tZXy5eVa/index.m3u8
T·∫≠p 09|https://s4.phim1280.tv/20240902/oz4kRHxo/index.m3u8
T·∫≠p 10|https://s4.phim1280.tv/20240902/gpI609pJ/index.m3u8
T·∫≠p 11|https://s4.phim1280.tv/20240902/xUrVd8wF/index.m3u8
T·∫≠p 12|https://s4.phim1280.tv/20240902/Csf5y5ea/index.m3u8
T·∫≠p 13|https://s4.phim1280.tv/20240902/dpGukr3a/index.m3u8
T·∫≠p 14|https://s4.phim1280.tv/20240902/raqbZK8W/index.m3u8
T·∫≠p 15|https://s4.phim1280.tv/20240902/p0dbdtCV/index.m3u8
T·∫≠p 16|https://s4.phim1280.tv/20240902/DAJ1aPht/index.m3u8
T·∫≠p 17|https://s4.phim1280.tv/20240902/32HJMyxH/index.m3u8
T·∫≠p 18|https://s4.phim1280.tv/20240902/dwHrM6X9/index.m3u8
T·∫≠p 19|https://s4.phim1280.tv/20240902/lIkT49nH/index.m3u8
T·∫≠p 20|https://s4.phim1280.tv/20240902/I7xOOHGv/index.m3u8
T·∫≠p 21|https://s4.phim1280.tv/20240902/ZHwwFGpT/index.m3u8
T·∫≠p 22|https://s4.phim1280.tv/20240902/Y6YFZf1I/index.m3u8
T·∫≠p 23|https://s4.phim1280.tv/20240902/osEqerpC/index.m3u8
T·∫≠p 24|https://s4.phim1280.tv/20240902/IszCdMJJ/index.m3u8
T·∫≠p 25|https://s4.phim1280.tv/20240902/UcgaQIy8/index.m3u8
T·∫≠p 26|https://s4.phim1280.tv/20240902/b6vOL0z2/index.m3u8
T·∫≠p 27|https://s4.phim1280.tv/20240902/Lld9jJhv/index.m3u8
T·∫≠p 28|https://s4.phim1280.tv/20240902/evZDqztr/index.m3u8
T·∫≠p 29|https://s4.phim1280.tv/20240902/ii77Y5Ur/index.m3u8
T·∫≠p 30|https://s4.phim1280.tv/20240902/RFGt0l9A/index.m3u8
T·∫≠p 31|https://s4.phim1280.tv/20240902/udjaoPjF/index.m3u8
T·∫≠p 32|https://s4.phim1280.tv/20240902/KoJy5F26/index.m3u8
T·∫≠p 33|https://s4.phim1280.tv/20240902/UexGW1KC/index.m3u8
T·∫≠p 34|https://s4.phim1280.tv/20240902/UzcisvC0/index.m3u8
T·∫≠p 35|https://s4.phim1280.tv/20240902/vwmU5Dqr/index.m3u8
T·∫≠p 36|https://s4.phim1280.tv/20240902/q8kWvxP3/index.m3u8
T·∫≠p 37|https://s4.phim1280.tv/20240902/pcV053Zf/index.m3u8
T·∫≠p 38|https://s4.phim1280.tv/20240902/5qYtUXrU/index.m3u8
T·∫≠p 39|https://s4.phim1280.tv/20240902/6MYLKhBA/index.m3u8
T·∫≠p 40|https://s4.phim1280.tv/20240902/3fWNeYaO/index.m3u8
T·∫≠p 41|https://s4.phim1280.tv/20240902/91I83K0q/index.m3u8
T·∫≠p 42|https://s4.phim1280.tv/20240902/s952CEmg/index.m3u8
T·∫≠p 43|https://s4.phim1280.tv/20240902/WPiED4QN/index.m3u8
T·∫≠p 44|https://s4.phim1280.tv/20240902/Qxlr84Rk/index.m3u8
T·∫≠p 45|https://s4.phim1280.tv/20240902/EBPVfPpA/index.m3u8
T·∫≠p 46|https://s4.phim1280.tv/20240902/wz7lSCVI/index.m3u8
T·∫≠p 47|https://s4.phim1280.tv/20240902/q6U5PdGa/index.m3u8
T·∫≠p 48|https://s4.phim1280.tv/20240902/IAoPWvC6/index.m3u8
T·∫≠p 49|https://s4.phim1280.tv/20240902/lf1u1s2u/index.m3u8
T·∫≠p 50|https://s4.phim1280.tv/20240902/A368EtxJ/index.m3u8
T·∫≠p 51|https://s4.phim1280.tv/20240902/Gc31K6ES/index.m3u8
T·∫≠p 52|https://s4.phim1280.tv/20240902/72u6OKhp/index.m3u8
T·∫≠p 53|https://s4.phim1280.tv/20240910/AgnW6jg5/index.m3u8
T·∫≠p 54|https://s4.phim1280.tv/20240916/pQwFfDJh/index.m3u8
T·∫≠p 55|https://s5.phim1280.tv/20240925/ev5LaTe5/index.m3u8
T·∫≠p 56|https://s5.phim1280.tv/20240930/wJyZTmgh/index.m3u8
T·∫≠p 57|https://s5.phim1280.tv/20241008/tZhxIMfd/index.m3u8
T·∫≠p 58|https://s4.phim1280.tv/20241021/AvZ9KDGX/index.m3u8
T·∫≠p 59|https://s4.phim1280.tv/20241021/hbsz3IqB/index.m3u8
T·∫≠p 60|https://s5.phim1280.tv/20241028/C5zAGgfh/index.m3u8
T·∫≠p 61|https://s4.phim1280.tv/20241104/ubgQPtgV/index.m3u8
T·∫≠p 62|https://s5.phim1280.tv/20241112/L2S2UFfL/index.m3u8
T·∫≠p 63|https://s4.phim1280.tv/20241126/xzwaQY40/index.m3u8
T·∫≠p 64|https://s4.phim1280.tv/20241126/ZPy2j4fV/index.m3u8
T·∫≠p 65|https://s4.phim1280.tv/20241209/9sv21U3V/index.m3u8
T·∫≠p 66|https://s4.phim1280.tv/20241209/lHJqyIqQ/index.m3u8
T·∫≠p 67|https://s4.phim1280.tv/20241223/npxPlKjZ/index.m3u8
T·∫≠p 68|https://s4.phim1280.tv/20241223/SfYqeLSI/index.m3u8
T·∫≠p 69|https://s5.phim1280.tv/20241230/vpoQSKuU/index.m3u8
T·∫≠p 70|https://s5.phim1280.tv/20250113/HbYRkB5Q/index.m3u8
T·∫≠p 71|https://s5.phim1280.tv/20250113/TJlfC5Ym/index.m3u8
T·∫≠p 72|https://s5.phim1280.tv/20250121/GsCqvjIJ/index.m3u8
T·∫≠p 73|https://s4.phim1280.tv/20250128/5fmooGLO/index.m3u8
T·∫≠p 74|https://s4.phim1280.tv/20250203/hn7glH9O/index.m3u8
T·∫≠p 75|https://s4.phim1280.tv/20250211/ZGjJUTzf/index.m3u8
T·∫≠p 76|https://s4.phim1280.tv/20250217/FnsyBqiP/index.m3u8
T·∫≠p 77|https://s5.phim1280.tv/20250225/kerZ5vM0/index.m3u8
T·∫≠p 78|https://s4.phim1280.tv/20250307/OI61voPZ/index.m3u8
T·∫≠p 79|https://s4.phim1280.tv/20250310/AzMBuXLM/index.m3u8
T·∫≠p 80|https://s5.phim1280.tv/20250322/ExajaR4u/index.m3u8
T·∫≠p 81|https://s5.phim1280.tv/20250324/BcQQ8wlx/index.m3u8
T·∫≠p 82|https://s4.phim1280.tv/20250401/H4EySjYc/index.m3u8
T·∫≠p 83|https://s5.phim1280.tv/20250407/WHjTD1Bv/index.m3u8
T·∫≠p 84|https://s4.phim1280.tv/20250414/qF3LiXXQ/index.m3u8
T·∫≠p 85|https://s5.phim1280.tv/20250421/h4YYM2VR/index.m3u8
T·∫≠p 86|https://s4.phim1280.tv/20250428/3JFqX7zD/index.m3u8
T·∫≠p 87|https://s5.phim1280.tv/20250505/Zpo48XHh/index.m3u8
T·∫≠p 88|https://s5.phim1280.tv/20250512/Kg5rNTil/index.m3u8
T·∫≠p 89|https://s4.phim1280.tv/20250519/EYnWB7NX/index.m3u8
T·∫≠p 90|https://s6.kkphimplayer6.com/20250525/6VjWTWRK/index.m3u8
T·∫≠p 91|https://s6.kkphimplayer6.com/20250602/2gCXJwTu/index.m3u8
T·∫≠p 92|https://s6.kkphimplayer6.com/20250609/sbhhXwD0/index.m3u8
T·∫≠p 93|https://s6.kkphimplayer6.com/20250616/oPZUpkff/index.m3u8
T·∫≠p 94|https://s6.kkphimplayer6.com/20250625/ZmAN0RVB/index.m3u8
T·∫≠p 95|https://s6.kkphimplayer6.com/20250630/AfuvfaNo/index.m3u8
T·∫≠p 96|https://s6.kkphimplayer6.com/20250707/0cPvATsU/index.m3u8
T·∫≠p 97|https://s6.kkphimplayer6.com/20250713/XWc58Mqq/index.m3u8
T·∫≠p 98|https://s6.kkphimplayer6.com/20250720/9p8psu23/index.m3u8
T·∫≠p 99|https://s6.kkphimplayer6.com/20250728/DwPkieIz/index.m3u8
T·∫≠p 100|https://s6.kkphimplayer6.com/20250805/qRrLo11N/index.m3u8
T·∫≠p 101|https://s6.kkphimplayer6.com/20250811/rIeKyOog/index.m3u8
T·∫≠p 102|https://s6.kkphimplayer6.com/20250819/YHakKU9Y/index.m3u8
T·∫≠p 103|https://s6.kkphimplayer6.com/20250825/v4gxLfJd/index.m3u8
T·∫≠p 104|https://s6.kkphimplayer6.com/20250901/w0afEOVq/index.m3u8
T·∫≠p 105|https://s6.kkphimplayer6.com/20250907/KwVRQ6qF/index.m3u8
T·∫≠p 106|https://s6.kkphimplayer6.com/20250915/q8R2ht6s/index.m3u8
T·∫≠p 107|https://s6.kkphimplayer6.com/20250922/IqSifeBs/index.m3u8
T·∫≠p 108|https://s6.kkphimplayer6.com/20250930/ZIE5kF1t/index.m3u8
T·∫≠p 109|https://s6.kkphimplayer6.com/20251006/Nn9XuTXc/index.m3u8
T·∫≠p 110|https://s6.kkphimplayer6.com/20251013/PyQnpX5Y/index.m3u8
T·∫≠p 111|https://s6.kkphimplayer6.com/20251020/pwGh7FcV/index.m3u8
T·∫≠p 112|https://s6.kkphimplayer6.com/20251103/QgYDekJy/index.m3u8
T·∫≠p 113|https://s6.kkphimplayer6.com/20251103/7kaGY4Az/index.m3u8
T·∫≠p 114|https://s6.kkphimplayer6.com/20251109/Mlw3oaAX/index.m3u8
T·∫≠p 115|https://s6.kkphimplayer6.com/20251116/w3QUN352/index.m3u8
T·∫≠p 116|https://s6.kkphimplayer6.com/20251123/km737TkW/index.m3u8
T·∫≠p 117|https://s6.kkphimplayer6.com/20251130/XNRMqlJF/index.m3u8
T·∫≠p 118|https://s6.kkphimplayer6.com/20251208/Ozq3pc8f/index.m3u8
T·∫≠p 119|https://s6.kkphimplayer6.com/20251215/1LjoFDEH/index.m3u8
T·∫≠p 120|https://s6.kkphimplayer6.com/20251222/x4DDm68O/index.m3u8
T·∫≠p 121|https://s6.kkphimplayer6.com/20251229/B7MuH4x0/index.m3u8
T·∫≠p 122|https://s6.kkphimplayer6.com/20260105/hKA0MbvL/index.m3u8
T·∫≠p 123|https://s6.kkphimplayer6.com/20260112/TXODlCvA/index.m3u8
T·∫≠p 124|https://s6.kkphimplayer6.com/20260119/Za0qyXSD/index.m3u8
T·∫≠p 125|https://s6.kkphimplayer6.com/20260126/yJmCuVRM/index.m3u8

    `.trim();

    const RAW_THUYETMINH = `
      T·∫≠p 01|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/ugj0GZjf/index.m3u8
T·∫≠p 02|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/c1GR9Zsa/index.m3u8
T·∫≠p 03|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/VpbbdC3R/index.m3u8
T·∫≠p 04|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/erRrMv2R/index.m3u8
T·∫≠p 05|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/Hzcwhkcd/index.m3u8
T·∫≠p 06|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/sXBx4bqb/index.m3u8
T·∫≠p 07|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/3QmJe6am/index.m3u8
T·∫≠p 08|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/95SFCR97/index.m3u8
T·∫≠p 09|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/5buitfuk/index.m3u8
T·∫≠p 10|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/YWeegces/index.m3u8
T·∫≠p 11|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/WBX2IIyi/index.m3u8
T·∫≠p 12|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/EF1WtjX3/index.m3u8
T·∫≠p 13|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/zLYPMbqU/index.m3u8
T·∫≠p 14|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/Q6iMxqVH/index.m3u8
T·∫≠p 15|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/JcTmL833/index.m3u8
T·∫≠p 16|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/RcMvUDJC/index.m3u8
T·∫≠p 17|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/Z0LAMZci/index.m3u8
T·∫≠p 18|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/ITHgvqmI/index.m3u8
T·∫≠p 19|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/0mnuc0dc/index.m3u8
T·∫≠p 20|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/udDUJzpe/index.m3u8
T·∫≠p 21|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/XzTXe73o/index.m3u8
T·∫≠p 22|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/CNwWlY0k/index.m3u8
T·∫≠p 23|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/4ZMT9ewP/index.m3u8
T·∫≠p 24|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/BDG24UI7/index.m3u8
T·∫≠p 25|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/Vea3Ontx/index.m3u8
T·∫≠p 26|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/SFJKSttn/index.m3u8
T·∫≠p 27|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/4KL2pItc/index.m3u8
T·∫≠p 28|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/i29WWPkX/index.m3u8
T·∫≠p 29|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/39mr3Q4d/index.m3u8
T·∫≠p 30|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/d89688BO/index.m3u8
T·∫≠p 31|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/BB9WW1mv/index.m3u8
T·∫≠p 32|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/qNbLOvdv/index.m3u8
T·∫≠p 33|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/iFbDIxez/index.m3u8
T·∫≠p 34|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/0CR4spJV/index.m3u8
T·∫≠p 35|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/oCcIVwXu/index.m3u8
T·∫≠p 36|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/URmVV9CW/index.m3u8
T·∫≠p 37|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/8HANJsSq/index.m3u8
T·∫≠p 38|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/pqnBIDHJ/index.m3u8
T·∫≠p 39|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/refEbGlP/index.m3u8
T·∫≠p 40|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/OLH48i0L/index.m3u8
T·∫≠p 41|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/sfMxmvRi/index.m3u8
T·∫≠p 42|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/EY3yzhoY/index.m3u8
T·∫≠p 43|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/pSOOIWa4/index.m3u8
T·∫≠p 44|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/9Wr6ML5k/index.m3u8
T·∫≠p 45|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/ieYlBEGj/index.m3u8
T·∫≠p 46|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/W09paOdS/index.m3u8
T·∫≠p 47|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/Drgngkrr/index.m3u8
T·∫≠p 48|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/btrQ9G0L/index.m3u8
T·∫≠p 49|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/FaEKbECT/index.m3u8
T·∫≠p 50|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/azTDwnal/index.m3u8
T·∫≠p 51|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/YKAW1xIm/index.m3u8
T·∫≠p 52|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/E9KtNapm/index.m3u8
T·∫≠p 53|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/myXplTjT/index.m3u8
T·∫≠p 54|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/1vofssey/index.m3u8
T·∫≠p 55|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/d5qQMv8W/index.m3u8
T·∫≠p 56|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/beJavQLJ/index.m3u8
T·∫≠p 57|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/U3RNV5fT/index.m3u8
T·∫≠p 58|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/h7qE7W1r/index.m3u8
T·∫≠p 59|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/oheSCSfR/index.m3u8
T·∫≠p 60|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/TqOAWdlW/index.m3u8
T·∫≠p 61|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/CZYIYdB0/index.m3u8
T·∫≠p 62|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/aH16OBPf/index.m3u8
T·∫≠p 63|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/QhJEe7Ye/index.m3u8
T·∫≠p 64|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/yBhVDxoK/index.m3u8
T·∫≠p 65|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/EUFKJ7je/index.m3u8
T·∫≠p 66|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/2eC4oV6u/index.m3u8
T·∫≠p 67|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/3BAjfnT7/index.m3u8
T·∫≠p 68|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/GR5oQxzY/index.m3u8
T·∫≠p 69|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/FDQaOPrh/index.m3u8
T·∫≠p 70|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/lbfcPzwr/index.m3u8
T·∫≠p 71|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/RogYLwBj/index.m3u8
T·∫≠p 72|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/dtYLX9xR/index.m3u8
T·∫≠p 73|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/yGrC29DT/index.m3u8
T·∫≠p 74|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/msDf4yDa/index.m3u8
T·∫≠p 75|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/LFnRz3uP/index.m3u8
T·∫≠p 76|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/rH7hOhsU/index.m3u8
T·∫≠p 77|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/CXh7kVCR/index.m3u8
T·∫≠p 78|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/dOgPFizs/index.m3u8
T·∫≠p 79|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/WnDydGME/index.m3u8
T·∫≠p 80|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/IaLMYedw/index.m3u8
T·∫≠p 81|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/0ElVcn09/index.m3u8
T·∫≠p 82|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/cKZBNS5h/index.m3u8
T·∫≠p 83|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/fFc0tKDw/index.m3u8
T·∫≠p 84|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/dlKtY2jZ/index.m3u8
T·∫≠p 85|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/47eLqaDR/index.m3u8
T·∫≠p 86|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/pbkF3fyQ/index.m3u8
T·∫≠p 87|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/xhTMi4kQ/index.m3u8
T·∫≠p 88|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/MwXuRvll/index.m3u8
T·∫≠p 89|https://player.phimapi.com/player/?url=https://s5.phim1280.tv/20250519/sN5H2Ngt/index.m3u8
T·∫≠p 90|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250525/ku8sPrxf/index.m3u8
T·∫≠p 91|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250602/v5GiwBe7/index.m3u8
T·∫≠p 92|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250609/3GHDlNTg/index.m3u8
T·∫≠p 93|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250616/0tia1b8V/index.m3u8
T·∫≠p 94|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250625/7N8UNab0/index.m3u8
T·∫≠p 95|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250630/AnG7mJ0v/index.m3u8
T·∫≠p 96|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250707/sqImxdGu/index.m3u8
T·∫≠p 97|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250713/UPHk8bQ3/index.m3u8
T·∫≠p 98|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250720/hCp01J7I/index.m3u8
T·∫≠p 99|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250728/JDMDrCUK/index.m3u8
T·∫≠p 100|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250805/NhzNJMxZ/index.m3u8
T·∫≠p 101|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250811/LDdHp44I/index.m3u8
T·∫≠p 102|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250819/BpMIlM4R/index.m3u8
T·∫≠p 103|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250825/MNQ88Oi0/index.m3u8
T·∫≠p 104|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250901/skyfgLtw/index.m3u8
T·∫≠p 105|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250907/OYHlv9oY/index.m3u8
T·∫≠p 106|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250915/tv79j46j/index.m3u8
T·∫≠p 107|https://player.phimapi.com/player/?url=https://s6.kkphimplayer6.com/20250922/7F81IsvL/index.m3u8

    `.trim();

    /* =========================================================
      AFF (7/3) = 7 NH·∫§N KH√îNG NH·∫¢Y, 3 NH·∫§N M·ªöI NH·∫¢Y
      - Mobile: ∆∞u ti√™n m·ªü app (universal/deeplink) + fallback web
      - PC: m·ªü web (tab m·ªõi)
    ========================================================= */
    const AFF_RATE = 0.; // 3/10 nh·∫£y

    const TIKTOK_WEB = "https://vt.tiktok.com/ZS91xpNUw7kcD-nRXjG/"; // universal link
    const SHOPEE_WEB = ""; // em ƒëi·ªÅn link aff shopee web
    const SHOPEE_APP = ""; // em ƒëi·ªÅn deep link shopee n·∫øu c√≥

    function isMobileDevice(){
      return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    function openMobileWithFallback(appUrl, webUrl){
      const hasWeb = !!(webUrl && webUrl.trim());
      const hasApp = !!(appUrl && appUrl.trim());

      if (!hasApp){
        if (hasWeb) window.location.href = webUrl;
        return;
      }

      window.location.href = appUrl;

      setTimeout(() => {
        if (hasWeb) window.location.href = webUrl;
      }, 900);
    }

    function openAFFRandom(){
      const sources = [];

      // TikTok: universal link tr√™n mobile hay t·ª± m·ªü app
      sources.push({
        name:"tiktok",
        mobileApp:"",
        mobileWeb:TIKTOK_WEB,
        pcWeb:TIKTOK_WEB
      });

      // Shopee
      if (SHOPEE_WEB || SHOPEE_APP){
        sources.push({
          name:"shopee",
          mobileApp:SHOPEE_APP,
          mobileWeb:SHOPEE_WEB,
          pcWeb:SHOPEE_WEB
        });
      }

      if (!sources.length) return;

      const pick = sources[Math.floor(Math.random() * sources.length)];
      if (isMobileDevice()){
        openMobileWithFallback(pick.mobileApp, pick.mobileWeb || pick.pcWeb);
      } else {
        const url = pick.pcWeb || pick.mobileWeb;
        if (url) window.open(url, "_blank");
      }
    }

    function maybeOpenAFF(){
     
      if (Math.random() < AFF_RATE){
        // delay nh·∫π cho ƒë·ª° kh√≥ ch·ªãu
        setTimeout(() => openAFFRandom(), 800);
      }
    }

    /* =========================================================
      AUTO PARSE LIST -> map epNumber => url
    ========================================================= */
    function parseRawToMap(raw){
      const map = {};
      if (!raw) return map;

      const lines = raw.split("\n").map(s => s.trim()).filter(Boolean);

      for (const line of lines){
        // d·∫°ng: "T·∫≠p 01|https://..."
        const parts = line.split("|");
        if (parts.length < 2) continue;
        const left = parts[0].trim();  // "T·∫≠p 01"
        const url  = parts.slice(1).join("|").trim(); // ph√≤ng tr∆∞·ªùng h·ª£p link c√≥ |
        const m = left.match(/(\d+)/);
        if (!m) continue;
        const ep = parseInt(m[1], 10);
        if (Number.isFinite(ep) && url) map[ep] = url;
      }
      return map;
    }

    // T·∫°o map link cho 2 ch·∫ø ƒë·ªô
    const MAP_VIETSUB    = parseRawToMap(RAW_VIETSUB);
    const MAP_THUYETMINH = parseRawToMap(RAW_THUYETMINH);

    /* =========================================================
      PLAYER (3-in-1): m3u8 / player.phimapi / embed kh√°c
    ========================================================= */
    let hls = null;

    function isM3U8(url){
      return /\.m3u8(\?|#|$)/i.test(url) || /\/index\.m3u8(\?|#|$)/i.test(url);
    }
    function isPhimApiPlayer(url){
      return /player\.phimapi\.com\/player\/\?url=/i.test(url);
    }
    function isProbablyEmbed(url){
      // N·∫øu l√† https page/ player / embed ... ∆∞u ti√™n iframe
      return /^https?:\/\//i.test(url) && !isM3U8(url);
    }

    function clearPlayer(){
      const box = document.getElementById("playerBox");
      box.innerHTML = `<div class="playerMsg" id="playerMsg">
        Ch·ªçn t·∫≠p ƒë·ªÉ xem. (H·ªó tr·ª£: m3u8 / player.phimapi / link embed kh√°c)
      </div>`;
      if (hls){
        try{ hls.destroy(); }catch(e){}
        hls = null;
      }
    }

    function setPlayerTypeText(txt){
      document.getElementById("playerTypeLabel").textContent = txt;
    }

    function playM3U8(url){
      const box = document.getElementById("playerBox");
      box.innerHTML = "";
      const video = document.createElement("video");
      video.controls = true;
      video.playsInline = true;
      video.autoplay = true;
      box.appendChild(video);

      // Safari iOS th∆∞·ªùng ph√°t native m3u8
      if (video.canPlayType("application/vnd.apple.mpegurl")){
        video.src = url;
        setPlayerTypeText("ƒêang ph√°t: m3u8 (native)");
        return;
      }

      // HLS.js
      if (window.Hls && Hls.isSupported()){
        hls = new Hls({
          enableWorker:true,
          lowLatencyMode:true
        });
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.ERROR, function(_, data){
          // N·∫øu l·ªói, b√°o nh·∫π
          setPlayerTypeText("L·ªói ph√°t m3u8 (c√≥ th·ªÉ do CORS/Referer/token)");
        });
        setPlayerTypeText("ƒêang ph√°t: m3u8 (hls.js)");
        return;
      }

      // fallback
      video.src = url;
      setPlayerTypeText("ƒêang ph√°t: m3u8 (fallback)");
    }

    function playIFRAME(url){
      const box = document.getElementById("playerBox");
      box.innerHTML = "";
      const iframe = document.createElement("iframe");
      iframe.allow = "autoplay; fullscreen; picture-in-picture";
      iframe.referrerPolicy = "no-referrer"; // gi·∫£m r·ªßi ro referrer
      iframe.src = url;
      box.appendChild(iframe);

      if (isPhimApiPlayer(url)){
        setPlayerTypeText("ƒêang ph√°t: player.phimapi (iframe)");
      } else {
        setPlayerTypeText("ƒêang ph√°t: embed (iframe)");
      }
    }

       function playURL(url){
  if (!url){
    clearPlayer();
    return;
  }

  // 1) N·∫øu l√† link player.phimapi => th·ª≠ b√≥c url=...m3u8 ƒë·ªÉ ph√°t tr·ª±c ti·∫øp
  if (isPhimApiPlayer(url)) {
    const u = new URL(url);
    const inner = u.searchParams.get("url");
    if (inner && isM3U8(inner)) {
      playM3U8(inner);
      setPlayerTypeText("ƒêang ph√°t:)");
      return;
    }

    // kh√¥ng b√≥c ƒë∆∞·ª£c => m·ªü tab m·ªõi
    window.open(url, "_blank");
    setPlayerTypeText("player.phimapi b·ªã ch·∫∑n iframe ‚Üí m·ªü tab m·ªõi");
    return;
  }

  // 2) m3u8 th∆∞·ªùng => ph√°t trong video
  if (isM3U8(url)){
    playM3U8(url);
    return;
  }

  // 3) link embed kh√°c (n·∫øu kh√¥ng b·ªã ch·∫∑n) => iframe
  if (isProbablyEmbed(url)){
    playIFRAME(url);
    return;
  }

  // 4) fallback
  window.open(url, "_blank");
  setPlayerTypeText("M·ªü link ngo√†i (fallback)");
}

    

    /* =========================================================
      UI + EP LIST
    ========================================================= */
    const $ = (id)=>document.getElementById(id);

    function showModal(title, msg, sub){
      $("modalTitle").textContent = title;
      $("modalMsg").textContent = msg;
      $("modalSub").textContent = sub || "";
      $("modalBack").style.display = "flex";
    }
    function hideModal(){ $("modalBack").style.display = "none"; }

    function scrollToEpisodes(){
      $("epGrid").scrollIntoView({behavior:"smooth", block:"start"});
    }

    // Mode: "vs" ho·∫∑c "tm"
    let MODE = "vs";
    let CURRENT_EP = null;

    function setMode(mode){
      MODE = mode;

      $("btnVS").classList.toggle("active", MODE === "vs");
      $("btnTM").classList.toggle("active", MODE === "tm");

      $("modeLabel").textContent = "ƒêang ch·ªçn: " + (MODE === "vs" ? "Vietsub" : "Thuy·∫øt minh");

      // Khi ƒë·ªïi mode: gi·ªØ t·∫≠p ƒëang ch·ªçn n·∫øu mode ƒë√≥ c√≥ link, kh√¥ng th√¨ ch·ªâ update UI
      renderEpisodes();
      if (CURRENT_EP != null){
        const url = getUrlForEp(CURRENT_EP);
        if (url){
          playEpisode(CURRENT_EP, true); // true = kh√¥ng trigger aff khi ƒë·ªïi mode
        } else {
          // kh√¥ng c√≥ link ·ªü mode m·ªõi
          $("nowPlayingTitle").textContent = `${MOVIE_TITLE} ‚Äì T·∫≠p ${String(CURRENT_EP).padStart(2,"0")}`;
          setPlayerTypeText("Ch∆∞a c√≥ link ·ªü ch·∫ø ƒë·ªô n√†y");
        }
      }
    }

    function getUrlForEp(ep){
      return MODE === "vs" ? MAP_VIETSUB[ep] : MAP_THUYETMINH[ep];
    }

    function getMaxEpForMode(){
      return MODE === "vs" ? COUNT_VIETSUB : COUNT_THUYETMINH;
    }

    function getEpList(){
      const total = getMaxEpForMode();
      const arr = Array.from({length: total}, (_,i)=>i+1);

      const q = ($("epSearch").value || "").trim();
      let out = arr;
      if (q){
        const n = parseInt(q, 10);
        if (!Number.isNaN(n)) out = arr.filter(x => x === n);
      }

      const sortMode = $("epSort").value;
      if (sortMode === "desc") out = out.slice().sort((a,b)=>b-a);
      else if (sortMode === "done"){
        out = out.slice().sort((a,b)=>{
          const da = !!getUrlForEp(a);
          const db = !!getUrlForEp(b);
          if (da === db) return a-b;
          return db - da;
        });
      }
      return out;
    }

    function renderEpisodes(){
      const grid = $("epGrid");
      grid.innerHTML = "";

      const eps = getEpList();
      eps.forEach(ep=>{
        const btn = document.createElement("button");
        btn.className = "epBtn";
        btn.type = "button";
        btn.textContent = String(ep).padStart(2,"0");

        const hasLink = !!getUrlForEp(ep);
        if (hasLink) btn.classList.add("done");
        else btn.classList.add("lock");

        const note = document.createElement("small");
        note.textContent = hasLink ? "C√≥ link" : "ƒêang c·∫≠p nh·∫≠t";
        btn.appendChild(note);

        btn.onclick = () => playEpisode(ep);
        grid.appendChild(btn);
      });
    }

    function playEpisode(ep, silentAff){
      const url = getUrlForEp(ep);
      CURRENT_EP = ep;

      $("nowPlayingTitle").textContent = `${MOVIE_TITLE} ‚Äì T·∫≠p ${String(ep).padStart(2,"0")} (${MODE === "vs" ? "Vietsub" : "Thuy·∫øt minh"})`;

      if (!url){
        setPlayerTypeText("Ch∆∞a c√≥ link");
        showModal(`${MOVIE_TITLE} ‚Äì T·∫≠p ${ep}`, "T·∫≠p n√†y ch∆∞a c√≥ link ·ªü ch·∫ø ƒë·ªô ƒëang ch·ªçn.", "B·∫°n quay l·∫°i sau nha.");
        return;
      }

      // ph√°t ngay trong trang
      playURL(url);

      // 7/3: ch·ªâ 3/10 m·ªõi nh·∫£y (v√† n·∫øu silentAff=true th√¨ b·ªè qua)
      if (!silentAff) maybeOpenAFF();
    }

    /* =========================================================
      INIT
    ========================================================= */
    $("movieInfo").textContent = `${MOVIE_TITLE} ‚Ä¢ ${TOTAL_EP_DISPLAY} t·∫≠p`;
    $("movieTitleTop").textContent = MOVIE_TITLE;
    $("movieTitleLeft").textContent = MOVIE_TITLE;
    $("totalEpShow").textContent = TOTAL_EP_DISPLAY;
    $("vsCount").textContent = COUNT_VIETSUB;
    $("tmCount").textContent = COUNT_THUYETMINH;
    $("subInfo").textContent = `C·∫≠p nh·∫≠t: Vietsub ${COUNT_VIETSUB} ‚Ä¢ Thuy·∫øt minh ${COUNT_THUYETMINH}`;

    $("btnVS").addEventListener("click", ()=>setMode("vs"));
    $("btnTM").addEventListener("click", ()=>setMode("tm"));

    $("epSearch").addEventListener("input", renderEpisodes);
    $("epSort").addEventListener("change", renderEpisodes);

    $("closeModal").addEventListener("click", hideModal);
    $("modalBack").addEventListener("click", (e)=>{ if(e.target.id==="modalBack") hideModal(); });
    document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") hideModal(); });

    // default: Vietsub
    setMode("vs");
    clearPlayer();
  </script>
</body>
</html>
