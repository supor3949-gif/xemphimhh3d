<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Xem phim | HH3D</title>

  <style>
    body{margin:0;font-family:Arial,sans-serif;background:#0f172a;color:#e5e7eb}
    header{background:#020617;padding:16px;text-align:center;font-size:22px;font-weight:800}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    a{color:inherit;text-decoration:none}
    .back{display:inline-block;margin:6px 0 14px;color:#22c55e}

    .playerWrap{
      background:#020617;border:1px solid rgba(255,255,255,.08);
      border-radius:14px;padding:12px;box-shadow:0 8px 30px rgba(0,0,0,.35);
    }
    .playerTitle{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;flex-wrap:wrap}
    .badge{color:#94a3b8;font-size:13px}
    video{
      width:100%;max-height:520px;background:#000;border-radius:12px;
      outline:none;
    }

    .episodes{
      margin-top:14px;background:#020617;border:1px solid rgba(255,255,255,.08);
      border-radius:14px;padding:12px;
    }
    .epHead{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .epGrid{
      margin-top:10px;
      display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));
      gap:8px;
    }
    .epBtn{
      cursor:pointer;border:1px solid rgba(255,255,255,.12);
      background:#0b1020;color:#cbd5e1;
      padding:10px 8px;border-radius:12px;font-weight:800;
      transition:.15s; text-align:center;
    }
    .epBtn:hover{transform:translateY(-1px)}
    .epBtn.active{background:#22c55e;color:#062a16;border-color:transparent}
    .note{color:#94a3b8;font-size:13px;margin-top:8px;line-height:1.4}
    .err{color:#fca5a5;font-size:13px;margin-top:8px;display:none}
  </style>
</head>
<body>
  <header>üé¨ Xem phim HH3D</header>

  <div class="container">
    <a class="back" href="phim.html">‚Üê Quay v·ªÅ danh s√°ch phim</a>

    <div class="playerWrap">
      <div class="playerTitle">
        <div>
          <div id="filmName" style="font-size:20px;font-weight:900">Ti√™n Ngh·ªãch</div>
          <div class="badge" id="nowPlaying">Ch·ªçn t·∫≠p ƒë·ªÉ xem</div>
        </div>
        <div class="badge">HLS (m3u8)</div>
      </div>

      <video id="video" controls playsinline></video>
      <div id="err" class="err"></div>
    </div>

    <div class="episodes">
      <div class="epHead">
        <div style="font-size:16px;font-weight:900">Danh s√°ch t·∫≠p</div>
        <div class="badge" id="countInfo">126 t·∫≠p</div>
      </div>

      <div id="epGrid" class="epGrid"></div>

      <div class="note">
        ‚úÖ Em ch·ªâ c·∫ßn d√°n link m3u8 c·ªßa em v√†o m·∫£ng <b>EP_URLS</b> b√™n d∆∞·ªõi (126 d√≤ng).<br/>
        N·∫øu t·∫≠p n√†o ch∆∞a c√≥ link th√¨ ƒë·ªÉ tr·ªëng "" (b·∫•m s·∫Ω b√°o l·ªói).
      </div>
    </div>
  </div>

  <!-- hls.js ƒë·ªÉ ch·∫°y m3u8 tr√™n Chrome/Edge/Firefox -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script>
    // ====== (1) L·∫§Y T√äN PHIM T·ª™ URL (t√πy ch·ªçn) ======
    // V√≠ d·ª•: xem.html?name=Ti√™n%20Ngh·ªãch
    const params = new URLSearchParams(location.search);
    const filmName = params.get("name") || "Ti√™n Ngh·ªãch";
    document.getElementById("filmName").textContent = filmName;

    // ====== (2) CH·ªñ EM D√ÅN 126 LINK M3U8 C·ª¶A EM V√ÄO ƒê√ÇY ======
    // L∆∞u √Ω: ƒë·ªß 126 ph·∫ßn t·ª≠. T·∫≠p 1 n·∫±m ·ªü index 0.
    const EP_URLS = [
      "", // T·∫≠p 01
      "", // T·∫≠p 02
      "", // T·∫≠p 03
      "", // T·∫≠p 04
      "", // T·∫≠p 05
      "", // T·∫≠p 06
      "", // T·∫≠p 07
      "", // T·∫≠p 08
      "", // T·∫≠p 09
      "", // T·∫≠p 10
      "", // T·∫≠p 11
      "", // T·∫≠p 12
      "", // T·∫≠p 13
      "", // T·∫≠p 14
      "", // T·∫≠p 15
      "", // T·∫≠p 16
      "", // T·∫≠p 17
      "", // T·∫≠p 18
      "", // T·∫≠p 19
      "", // T·∫≠p 20
      "", // T·∫≠p 21
      "", // T·∫≠p 22
      "", // T·∫≠p 23
      "", // T·∫≠p 24
      "", // T·∫≠p 25
      "", // T·∫≠p 26
      "", // T·∫≠p 27
      "", // T·∫≠p 28
      "", // T·∫≠p 29
      "", // T·∫≠p 30
      "", // T·∫≠p 31
      "", // T·∫≠p 32
      "", // T·∫≠p 33
      "", // T·∫≠p 34
      "", // T·∫≠p 35
      "", // T·∫≠p 36
      "", // T·∫≠p 37
      "", // T·∫≠p 38
      "", // T·∫≠p 39
      "", // T·∫≠p 40
      "", // T·∫≠p 41
      "", // T·∫≠p 42
      "", // T·∫≠p 43
      "", // T·∫≠p 44
      "", // T·∫≠p 45
      "", // T·∫≠p 46
      "", // T·∫≠p 47
      "", // T·∫≠p 48
      "", // T·∫≠p 49
      "", // T·∫≠p 50
      "", // T·∫≠p 51
      "", // T·∫≠p 52
      "", // T·∫≠p 53
      "", // T·∫≠p 54
      "", // T·∫≠p 55
      "", // T·∫≠p 56
      "", // T·∫≠p 57
      "", // T·∫≠p 58
      "", // T·∫≠p 59
      "", // T·∫≠p 60
      "", // T·∫≠p 61
      "", // T·∫≠p 62
      "", // T·∫≠p 63
      "", // T·∫≠p 64
      "", // T·∫≠p 65
      "", // T·∫≠p 66
      "", // T·∫≠p 67
      "", // T·∫≠p 68
      "", // T·∫≠p 69
      "", // T·∫≠p 70
      "", // T·∫≠p 71
      "", // T·∫≠p 72
      "", // T·∫≠p 73
      "", // T·∫≠p 74
      "", // T·∫≠p 75
      "", // T·∫≠p 76
      "", // T·∫≠p 77
      "", // T·∫≠p 78
      "", // T·∫≠p 79
      "", // T·∫≠p 80
      "", // T·∫≠p 81
      "", // T·∫≠p 82
      "", // T·∫≠p 83
      "", // T·∫≠p 84
      "", // T·∫≠p 85
      "", // T·∫≠p 86
      "", // T·∫≠p 87
      "", // T·∫≠p 88
      "", // T·∫≠p 89
      "", // T·∫≠p 90
      "", // T·∫≠p 91
      "", // T·∫≠p 92
      "", // T·∫≠p 93
      "", // T·∫≠p 94
      "", // T·∫≠p 95
      "", // T·∫≠p 96
      "", // T·∫≠p 97
      "", // T·∫≠p 98
      "", // T·∫≠p 99
      "", // T·∫≠p 100
      "", // T·∫≠p 101
      "", // T·∫≠p 102
      "", // T·∫≠p 103
      "", // T·∫≠p 104
      "", // T·∫≠p 105
      "", // T·∫≠p 106
      "", // T·∫≠p 107
      "", // T·∫≠p 108
      "", // T·∫≠p 109
      "", // T·∫≠p 110
      "", // T·∫≠p 111
      "", // T·∫≠p 112
      "", // T·∫≠p 113
      "", // T·∫≠p 114
      "", // T·∫≠p 115
      "", // T·∫≠p 116
      "", // T·∫≠p 117
      "", // T·∫≠p 118
      "", // T·∫≠p 119
      "", // T·∫≠p 120
      "", // T·∫≠p 121
      "", // T·∫≠p 122
      "", // T·∫≠p 123
      "", // T·∫≠p 124
      "", // T·∫≠p 125
      ""  // T·∫≠p 126
    ];

    // ====== (3) RENDER N√öT T·∫¨P ======
    const epGrid = document.getElementById("epGrid");
    const countInfo = document.getElementById("countInfo");
    countInfo.textContent = EP_URLS.length + " t·∫≠p";

    for (let i = 1; i <= EP_URLS.length; i++) {
      const btn = document.createElement("button");
      btn.className = "epBtn";
      btn.textContent = "T·∫≠p " + String(i).padStart(2, "0");
      btn.onclick = () => playEpisode(i);
      epGrid.appendChild(btn);
    }

    // ====== (4) PLAYER HLS ======
    const video = document.getElementById("video");
    const nowPlaying = document.getElementById("nowPlaying");
    const errBox = document.getElementById("err");
    let hls;

    function setActiveEp(ep) {
      [...document.querySelectorAll(".epBtn")].forEach((b, idx) => {
        b.classList.toggle("active", idx === ep - 1);
      });
    }

    function showError(msg) {
      errBox.style.display = "block";
      errBox.textContent = msg;
    }

    function clearError() {
      errBox.style.display = "none";
      errBox.textContent = "";
    }

    function loadHls(url) {
      clearError();

      // Safari iOS/macOS c√≥ HLS native
      if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = url;
        video.play().catch(()=>{});
        return;
      }

      // Chrome/Edge/Firefox d√πng hls.js
      if (window.Hls && Hls.isSupported()) {
        if (hls) hls.destroy();
        hls = new Hls({
          // C√≥ th·ªÉ ch·ªânh sau n·∫øu c·∫ßn
          enableWorker: true
        });
        hls.loadSource(url);
        hls.attachMedia(video);

        hls.on(Hls.Events.ERROR, function (event, data) {
          // hay g·∫∑p nh·∫•t l√† CORS / token / forbidden
          showError("Kh√¥ng ph√°t ƒë∆∞·ª£c link n√†y (c√≥ th·ªÉ do CORS/forbidden). H√£y th·ª≠ link kh√°c ho·∫∑c c·∫•u h√¨nh ngu·ªìn m3u8.");
        });

        video.play().catch(()=>{});
      } else {
        showError("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ HLS.");
      }
    }

    function playEpisode(ep) {
      const url = EP_URLS[ep - 1];
      setActiveEp(ep);

      if (!url || !url.trim()) {
        nowPlaying.textContent = `${filmName} ‚Ä¢ T·∫≠p ${String(ep).padStart(2,"0")} (ch∆∞a c√≥ link)`;
        showError("T·∫≠p n√†y ch∆∞a c√≥ link m3u8. Em d√°n link v√†o EP_URLS r·ªìi th·ª≠ l·∫°i.");
        video.removeAttribute("src");
        video.load();
        return;
      }

      nowPlaying.textContent = `${filmName} ‚Ä¢ T·∫≠p ${String(ep).padStart(2,"0")}`;
      loadHls(url.trim());
    }

    // T·ª± ch·ªçn t·∫≠p t·ª´ URL: xem.html?ep=1
    const epFromUrl = parseInt(params.get("ep") || "0", 10);
    if (epFromUrl >= 1 && epFromUrl <= EP_URLS.length) playEpisode(epFromUrl);
  </script>
</body>
</html>
